1.1
explain select * from city;

+----+-------------+-------+------+---------------+------+---------+------+------+-------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |
+----+-------------+-------+------+---------------+------+---------+------+------+-------+
|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL |   59 | NULL  |
+----+-------------+-------+------+---------------+------+---------+------+------+-------+
1 row in set (0.00 sec)


1.2
explain select name from city;

+----+-------------+-------+------+---------------+------+---------+------+------+-------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |
+----+-------------+-------+------+---------------+------+---------+------+------+-------+
|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL |   59 | NULL  |
+----+-------------+-------+------+---------------+------+---------+------+------+-------+
1 row in set (0.00 sec)


1.3
explain select distinct province from city;

+----+-------------+-------+------+---------------+------+---------+------+------+-------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |
+----+-------------+-------+------+---------------+------+---------+------+------+-------+
|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL |   59 | NULL  |
+----+-------------+-------+------+---------------+------+---------+------+------+-------+
1 row in set (0.00 sec)

1.4
(1)
explain select * from city where cid=1;

+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | city  | const | PRIMARY       | PRIMARY | 4       | const |    1 | NULL  |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
1 row in set (0.00 sec)

(2)
explain select * from city where cid>1 and cid<10;

+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
|  1 | SIMPLE      | city  | range | PRIMARY       | PRIMARY | 4       | NULL |    7 | Using where |
+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
1 row in set (0.00 sec)


1.5
explain select * from city where province='浙江';

+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL |   59 | Using where |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
1 row in set (0.00 sec)

create index index_province on city(province);

explain select * from city where province='浙江';
+----+-------------+-------+------+----------------+----------------+---------+-------+------+-----------------------+
| id | select_type | table | type | possible_keys  | key            | key_len | ref   | rows | Extra                 |
+----+-------------+-------+------+----------------+----------------+---------+-------+------+-----------------------+
|  1 | SIMPLE      | city  | ref  | index_province | index_province | 33      | const |    6 | Using index condition |
+----+-------------+-------+------+----------------+----------------+---------+-------+------+-----------------------+
1 row in set (0.00 sec)


1.6
explain select sid from shop where good_remarks>20 and very_bad_remarks<10;

+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
|  1 | SIMPLE      | shop  | ALL  | NULL          | NULL | NULL    | NULL |  979 | Using where |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
1 row in set (0.00 sec)

create index index_goodremarks on shop(good_remarks);
create index index_verybadremarks on shop(very_bad_remarks);

explain select sid from shop where good_remarks>20 and very_bad_remarks<10;
+----+-------------+-------+-------+----------------------------------------+-------------------+---------+------+------+------------------------------------+
| id | select_type | table | type  | possible_keys                          | key               | key_len | ref  | rows | Extra                              |
+----+-------------+-------+-------+----------------------------------------+-------------------+---------+------+------+------------------------------------+
|  1 | SIMPLE      | shop  | range | index_goodremarks,index_verybadremarks | index_goodremarks | 5       | NULL |  178 | Using index condition; Using where |
+----+-------------+-------+-------+----------------------------------------+-------------------+---------+------+------+------------------------------------+
1 row in set (0.00 sec)


1.7
(1)
explain select province from city where cid in ('1', '2', '3');

+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
|  1 | SIMPLE      | city  | range | PRIMARY       | PRIMARY | 4       | NULL |    3 | Using where |
+----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+
1 row in set (0.00 sec)

(2)
explain select name from city where province in ('浙江', '广州');

+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL |   59 | Using where |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
1 row in set (0.00 sec)

create index index_province on city(province);

explain select name from city where province in ('浙江', '广州');

+----+-------------+-------+-------+----------------+----------------+---------+------+------+-----------------------+
| id | select_type | table | type  | possible_keys  | key            | key_len | ref  | rows | Extra                 |
+----+-------------+-------+-------+----------------+----------------+---------+------+------+-----------------------+
|  1 | SIMPLE      | city  | range | index_province | index_province | 33      | NULL |    7 | Using index condition |
+----+-------------+-------+-------+----------------+----------------+---------+------+------+-----------------------+
1 row in set (0.00 sec)


1.8
explain select * from shop where avg_price<20 order by avg_price;

+----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                       |
+----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------+
|  1 | SIMPLE      | shop  | ALL  | NULL          | NULL | NULL    | NULL |  979 | Using where; Using filesort |
+----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------+
1 row in set (0.00 sec)

create index price on shop(avg_price);

explain select * from shop where avg_price<20 order by avg_price;

+----+-------------+-------+-------+---------------+-------+---------+------+------+-----------------------+
| id | select_type | table | type  | possible_keys | key   | key_len | ref  | rows | Extra                 |
+----+-------------+-------+-------+---------------+-------+---------+------+------+-----------------------+
|  1 | SIMPLE      | shop  | range | price         | price | 5       | NULL |  233 | Using index condition |
+----+-------------+-------+-------+---------------+-------+---------+------+------+-----------------------+
1 row in set (0.00 sec)


2.1
explain select sid from shop, city, address where shop.address=address.address and address.cid=city.cid and city.cid=1;
+----+-------------+---------+-------+---------------+---------+---------+-------+------+----------------------------------------------------+
| id | select_type | table   | type  | possible_keys | key     | key_len | ref   | rows | Extra                                              |
+----+-------------+---------+-------+---------------+---------+---------+-------+------+----------------------------------------------------+
|  1 | SIMPLE      | city    | const | PRIMARY       | PRIMARY | 4       | const |    1 | Using index                                        |
|  1 | SIMPLE      | address | ref   | cid           | cid     | 5       | const |  255 | NULL                                               |
|  1 | SIMPLE      | shop    | ALL   | NULL          | NULL    | NULL    | NULL  |  961 | Using where; Using join buffer (Block Nested Loop) |
+----+-------------+---------+-------+---------------+---------+---------+-------+------+----------------------------------------------------+
3 rows in set (0.00 sec)

create index index_address on address(address);

explain select sid from shop, city, address where shop.address=address.address and address.cid=city.cid and city.cid=1;
+----+-------------+---------+-------+-------------------+---------------+---------+---------------------+------+-------------+
| id | select_type | table   | type  | possible_keys     | key           | key_len | ref                 | rows | Extra       |
+----+-------------+---------+-------+-------------------+---------------+---------+---------------------+------+-------------+
|  1 | SIMPLE      | city    | const | PRIMARY           | PRIMARY       | 4       | const               |    1 | Using index |
|  1 | SIMPLE      | shop    | ALL   | NULL              | NULL          | NULL    | NULL                |  961 | Using where |
|  1 | SIMPLE      | address | ref   | cid,index_address | index_address | 303     | sqlopt.shop.address |    1 | Using where |
+----+-------------+---------+-------+-------------------+---------------+---------+---------------------+------+-------------+
3 rows in set (0.00 sec)

2.2


2.3
explain select cid from address where exists (select * from shop, address where shop.address=address.address and shop.avg_price<20);

+----+-------------+---------+-------+---------------+---------------+---------+---------------------+------+------------------------------------+
| id | select_type | table   | type  | possible_keys | key           | key_len | ref                 | rows | Extra                              |
+----+-------------+---------+-------+---------------+---------------+---------+---------------------+------+------------------------------------+
|  1 | PRIMARY     | address | index | NULL          | cid           | 5       | NULL                |  996 | Using index                        |
|  2 | SUBQUERY    | shop    | range | price         | price         | 5       | NULL                |  233 | Using index condition; Using where |
|  2 | SUBQUERY    | address | ref   | index_address | index_address | 303     | sqlopt.shop.address |    1 | Using index                        |
+----+-------------+---------+-------+---------------+---------------+---------+---------------------+------+------------------------------------+
3 rows in set (0.00 sec)

2.4
explain select name from (select * from shop where avg_price < 20) as D;

+----+-------------+------------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table      | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+------------+------+---------------+------+---------+------+------+-------------+
|  1 | PRIMARY     | <derived2> | ALL  | NULL          | NULL | NULL    | NULL |  961 | NULL        |
|  2 | DERIVED     | shop       | ALL  | NULL          | NULL | NULL    | NULL |  961 | Using where |
+----+-------------+------------+------+---------------+------+---------+------+------+-------------+
2 rows in set (0.00 sec)

create index price on shop(avg_price);

explain select name from (select * from shop where avg_price < 20) as D;
+----+-------------+------------+-------+---------------+-------+---------+------+------+-----------------------+
| id | select_type | table      | type  | possible_keys | key   | key_len | ref  | rows | Extra                 |
+----+-------------+------------+-------+---------------+-------+---------+------+------+-----------------------+
|  1 | PRIMARY     | <derived2> | ALL   | NULL          | NULL  | NULL    | NULL |  233 | NULL                  |
|  2 | DERIVED     | shop       | range | price         | price | 5       | NULL |  233 | Using index condition |
+----+-------------+------------+-------+---------------+-------+---------+------+------+-----------------------+
2 rows in set (0.00 sec)

change to:

explain select name from shop where avg_price < 20;
+----+-------------+-------+-------+---------------+-------+---------+------+------+-----------------------+
| id | select_type | table | type  | possible_keys | key   | key_len | ref  | rows | Extra                 |
+----+-------------+-------+-------+---------------+-------+---------+------+------+-----------------------+
|  1 | SIMPLE      | shop  | range | price         | price | 5       | NULL |  233 | Using index condition |
+----+-------------+-------+-------+---------------+-------+---------+------+------+-----------------------+
1 row in set (0.00 sec)


3.1
explain insert into city values('test', 'test', 11111);
+----+-------------+-------+------+---------------+------+---------+------+------+----------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra          |
+----+-------------+-------+------+---------------+------+---------+------+------+----------------+
|  1 | SIMPLE      | NULL  | NULL | NULL          | NULL | NULL    | NULL | NULL | No tables used |
+----+-------------+-------+------+---------------+------+---------+------+------+----------------+
1 row in set (0.00 sec)

3.2
explain delete from city where name='test';
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL |   59 | Using where |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
1 row in set (0.00 sec)

create index index_name on city(name);

explain delete from city where name='test';
+----+-------------+-------+-------+---------------+------------+---------+-------+------+-------------+
| id | select_type | table | type  | possible_keys | key        | key_len | ref   | rows | Extra       |
+----+-------------+-------+-------+---------------+------------+---------+-------+------+-------------+
|  1 | SIMPLE      | city  | range | index_name    | index_name | 303     | const |    1 | Using where |
+----+-------------+-------+-------+---------------+------------+---------+-------+------+-------------+
1 row in set (0.00 sec)





